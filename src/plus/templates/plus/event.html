{% extends "base.html" %}
{% load comments i18n plus_tags %}

{% block title %}{{ event.title }}{% endblock %}

{% block content %}
<h1>{{ event.title }}</h1>
<div id="details">{{ event.starts_at }}
{% if event.url %}<a class="a-right" href="{{ event.url }}">{{ event.url }}</a>{% endif %}</div>
<div id="description">{{ event.description|linebreaksbr }}</div>

{% if user.is_authenticated %}
    {% trans "You are logged in as" %} {{ user }}.
{% endif %}
{% if future_event %}
  {% if curr_attendance %}
    <br />
    <a href="./minus" class="minus">я не пайду</a>
  {% else %}
    {% if user.is_authenticated %}
      <a href="./plus" class="plus">я пайду</a>
    {% else %}
      login
    {% endif %}
  {% endif %}
{% endif %}

{% if goers or curr_attendance %}
      <h3>{% trans "They are going to the event:" %}</h3>
      <ul>
	{% if curr_attendance %}
	  {{ user.username }} <b>({% trans "you" %})</b>
	{% endif %}
	{% for usr in goers %}
	<li>{{ usr.username }}</li>
	{% endfor %}
      </ul>
{% endif %}
<hr />
{% get_comment_list for event as comment_list %}
{% for comment in comment_list|annotate_users %}
    {% if comment.user.soc_provider %}
       <a href="{{ comment.user.soc_link }}">[{{ comment.user.soc_provider }}] {{ comment.user.username }}</a>
    {% else %}
       <i>{{ comment.user.username }}</i>
    {% endif %}
    <span class="comment-date">{{ comment.submit_date|date:"j E Y г. G:i" }}</span>
    <div class="comment-text">{{ comment.comment|linebreaksbr }}</div>
{% endfor %}

<div id="comment-form-base-root2" class="comment-form">
{% render_comment_form for event %}
</div>

<hr />
<div>
  <ul>
    <li><a rel="nofollow" href="{% url socialauth_begin "twitter" %}">Twitter</a></li>
    <li><a rel="nofollow" href="{% url socialauth_begin "facebook" %}">Facebook</a></li>
    <li><a rel="nofollow" href="{% url socialauth_begin "google-oauth" %}">Google OAuth</a></li>
    <li><a rel="nofollow" href="#">Vkontakte</a></li>
  </ul>

  <form action="{% url socialauth_begin "openid" %}" method="post">{% csrf_token %}
    <div>
      <label for="openid_identifier">OpenID provider</label>
      <input id="openid_identifier" type="text" value="" name="openid_identifier" />
      <input type="submit" value="Login" />
    </div>
  </form>
</div>

{% endblock %}
